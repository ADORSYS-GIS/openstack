
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="OpenStack project backed by adorsys">
      
      
      
        <link rel="canonical" href="https://openstack.github.io/adorsys-gis/tutorials/setupvswitch/">
      
      
        <link rel="prev" href="../ntp_setup_tuto/">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>Setup vSwitch - Adorsys OpenStack</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2a3383ac.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="purple" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#how-to-set-up-a-virtual-switch-with-multipass" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Adorsys OpenStack" class="md-header__button md-logo" aria-label="Adorsys OpenStack" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Adorsys OpenStack
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Setup vSwitch
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/adorsys-gis/openstack" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    OpenStack
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Adorsys OpenStack" class="md-nav__button md-logo" aria-label="Adorsys OpenStack" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Adorsys OpenStack
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/adorsys-gis/openstack" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    OpenStack
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Documentation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ansible_docs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ansible
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../netplan_doc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NetPlan
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ntp_docs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NTP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../VLAN/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    VLAN
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    NetBird
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            NetBird
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../netbird/netbird_troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../netbird/netbird_access_review/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Access Review
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ansible_tuto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ansible Tutorial
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../boot_docs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Boot Documentation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../minimal_kvm_setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Minimal KVM Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ntp_setup_tuto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NTP Setup Tutorial
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Setup vSwitch
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Setup vSwitch
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-is-a-switchbridge-and-why-do-we-use-it" class="md-nav__link">
    <span class="md-ellipsis">
      What is a Switch/Bridge and Why Do We Use It?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#main-functions-of-a-bridge" class="md-nav__link">
    <span class="md-ellipsis">
      Main Functions of a Bridge
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#network-topology-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Network Topology Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-virtual-network" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a Virtual Network
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Creating a Virtual Network">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-up-the-virtual-switch" class="md-nav__link">
    <span class="md-ellipsis">
      Setting Up the Virtual Switch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-the-vms" class="md-nav__link">
    <span class="md-ellipsis">
      Creating the VMs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-vlan-tags" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring VLAN Tags
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-interface-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Network Interface Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-connectivity" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Connectivity
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-is-a-switchbridge-and-why-do-we-use-it" class="md-nav__link">
    <span class="md-ellipsis">
      What is a Switch/Bridge and Why Do We Use It?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#main-functions-of-a-bridge" class="md-nav__link">
    <span class="md-ellipsis">
      Main Functions of a Bridge
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#network-topology-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Network Topology Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-virtual-network" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a Virtual Network
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Creating a Virtual Network">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-up-the-virtual-switch" class="md-nav__link">
    <span class="md-ellipsis">
      Setting Up the Virtual Switch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-the-vms" class="md-nav__link">
    <span class="md-ellipsis">
      Creating the VMs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-vlan-tags" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring VLAN Tags
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-interface-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Network Interface Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-connectivity" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Connectivity
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="how-to-set-up-a-virtual-switch-with-multipass">How to Set Up a Virtual Switch with Multipass<a class="headerlink" href="#how-to-set-up-a-virtual-switch-with-multipass" title="Permanent link">&para;</a></h1>
<p>In this tutorial, we will configure a virtual switch (vswitch) for Multipass instances and make them accessible over the network.</p>
<h2 id="what-is-a-switchbridge-and-why-do-we-use-it">What is a Switch/Bridge and Why Do We Use It?<a class="headerlink" href="#what-is-a-switchbridge-and-why-do-we-use-it" title="Permanent link">&para;</a></h2>
<p>A switch is a networking device that helps us connect different computers together using ethernet cables. The switch has a MAC table that it uses to determine which computer on the network it is supposed to send data packets to. It is also one of the major component devices of layer 2 of the OSI model.</p>
<p>A bridge is a device that connects two or more local area networks (LANs) that use the same protocol. Bridges act the same way as switches (Virtual Switches in our case).</p>
<p>We are using a bridge here because our VMs are isolated from our host and we need to connect them so that they can talk with each other. A bridge allows the VMs to talk to each other as if they were on the same network.</p>
<h2 id="main-functions-of-a-bridge">Main Functions of a Bridge<a class="headerlink" href="#main-functions-of-a-bridge" title="Permanent link">&para;</a></h2>
<ul>
<li>Combines multiple VMs/Containers into a single logical network</li>
<li>Maintains MAC address table to intelligently forward frames</li>
<li>Allows devices on the same bridge to communicate directly (except when separated by VLANs)</li>
</ul>
<h2 id="network-topology-overview">Network Topology Overview<a class="headerlink" href="#network-topology-overview" title="Permanent link">&para;</a></h2>
<pre class="mermaid"><code>graph TD
    subgraph Host
        OVS[OVS Bridge: virt-bridge]
        OVS_VLAN0[OVS VLAN0]
        OVS_VLAN1[OVS VLAN1]
    end

    VM1 --&gt;|ens3| OVS_VLAN0
    VM2 --&gt;|ens3| OVS_VLAN0
    VM3 --&gt;|ens3| OVS_VLAN1
    VM4 --&gt;|ens3| OVS_VLAN1

    OVS_VLAN0 --&gt; OVS
    OVS_VLAN1 --&gt; OVS</code></pre>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h2>
<p>To follow along in this course, you will need:</p>
<ul>
<li>Ubuntu 22.04 LTS or Ubuntu 24.04 LTS</li>
<li><a href="https://canonical.com/multipass/install">Multipass</a> installed</li>
<li>Root permission or sudo if the user is in the sudoers group</li>
<li><code>ovs-vsctl</code> installed for creating bridges and adding ports</li>
</ul>
<p>The Open vSwitch (OVS) supports virtual LAN technology that helps us split our virtual network into smaller logical partitions for security enforcement:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>openvswitch-switch
</span></code></pre></div>
<h2 id="creating-a-virtual-network">Creating a Virtual Network<a class="headerlink" href="#creating-a-virtual-network" title="Permanent link">&para;</a></h2>
<p>After putting in place all the requirements, let's dive in!</p>
<h3 id="setting-up-the-virtual-switch">Setting Up the Virtual Switch<a class="headerlink" href="#setting-up-the-virtual-switch" title="Permanent link">&para;</a></h3>
<p>First, we will create a Virtual Switch with VLAN support:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># Create Open Virtual Switch (OVS)</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>sudo<span class="w"> </span>ovs-vsctl<span class="w"> </span>add-br<span class="w"> </span>virt-bridge
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>ip<span class="w"> </span>link<span class="w"> </span><span class="nb">set</span><span class="w"> </span>virt-bridge<span class="w"> </span>up<span class="w"> </span><span class="c1"># to make it known to your system</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="c1"># List available bridges</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>sudo<span class="w"> </span>ovs-vsctl<span class="w"> </span>list-br
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="c1"># Configure VLANs on the OVS</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>sudo<span class="w"> </span>ovs-vsctl<span class="w"> </span><span class="nb">set</span><span class="w"> </span>port<span class="w"> </span>virt-bridge<span class="w"> </span><span class="nv">vlan_mode</span><span class="o">=</span>native-untagged
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>sudo<span class="w"> </span>ovs-vsctl<span class="w"> </span><span class="nb">set</span><span class="w"> </span>port<span class="w"> </span>virt-bridge<span class="w"> </span><span class="nv">trunks</span><span class="o">=</span><span class="m">0</span>,1<span class="w"> </span><span class="c1"># to allow VLAN0 and VLAN1</span>
</span></code></pre></div>
<h3 id="creating-the-vms">Creating the VMs<a class="headerlink" href="#creating-the-vms" title="Permanent link">&para;</a></h3>
<p>Now let's create 4 VMs labeled test-vm1 through test-vm4:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1"># Creating VMs with a simple script</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">1</span>..4<span class="o">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span>multipass<span class="w"> </span>launch<span class="w"> </span>--name<span class="w"> </span>test-vm<span class="nv">$i</span><span class="w"> </span>--network<span class="w"> </span><span class="nv">name</span><span class="o">=</span>virt-bridge<span class="w"> </span>--network<span class="w"> </span><span class="nv">name</span><span class="o">=</span>default<span class="w"> </span><span class="m">24</span>.04
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="k">done</span>
</span></code></pre></div>
<p>This creates 4 VMs running Ubuntu 24.04.</p>
<h3 id="configuring-vlan-tags">Configuring VLAN Tags<a class="headerlink" href="#configuring-vlan-tags" title="Permanent link">&para;</a></h3>
<p>Now we'll configure the VLAN tags. VLAN uses the 802.1Q standard, adding a 12-bit tag to L2 packets that can only be decrypted by machines on the same VLAN.</p>
<ol>
<li>First, check available interfaces in your VMs:</li>
</ol>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>multipass<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="s2">&quot;test-vm1&quot;</span><span class="w"> </span>--<span class="w"> </span>ip<span class="w"> </span>-o<span class="w"> </span>link<span class="w"> </span>show<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span>-F<span class="w"> </span><span class="s1">&#39;: &#39;</span><span class="w"> </span><span class="s1">&#39;!/lo/ {print $2; exit}&#39;</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="c1"># Repeat for other VMs. Use your interface name if not ens3</span>
</span></code></pre></div>
<ol>
<li>Add machines to VLAN0:</li>
</ol>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>multipass<span class="w"> </span>stop<span class="w"> </span>test-vm1<span class="w"> </span>test-vm2<span class="w"> </span><span class="c1"># stop VMs before adding ports</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>sudo<span class="w"> </span>ovs-vsctl<span class="w"> </span><span class="nb">set</span><span class="w"> </span>port<span class="w"> </span>test-vm2-ens3<span class="w"> </span><span class="nv">tag</span><span class="o">=</span><span class="m">0</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>sudo<span class="w"> </span>ovs-vsctl<span class="w"> </span><span class="nb">set</span><span class="w"> </span>port<span class="w"> </span>test-vm1-ens3<span class="w"> </span><span class="nv">tag</span><span class="o">=</span><span class="m">0</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>multipass<span class="w"> </span>start<span class="w"> </span>test-vm1<span class="w"> </span>test-vm2
</span></code></pre></div>
<ol>
<li>Add machines to VLAN1:</li>
</ol>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>multipass<span class="w"> </span>stop<span class="w"> </span>test-vm3<span class="w"> </span>test-vm4
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>sudo<span class="w"> </span>ovs-vsctl<span class="w"> </span><span class="nb">set</span><span class="w"> </span>port<span class="w"> </span>test-vm3-ens3<span class="w"> </span><span class="nv">tag</span><span class="o">=</span><span class="m">1</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>sudo<span class="w"> </span>ovs-vsctl<span class="w"> </span><span class="nb">set</span><span class="w"> </span>port<span class="w"> </span>test-vm4-ens3<span class="w"> </span><span class="nv">tag</span><span class="o">=</span><span class="m">1</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>multipass<span class="w"> </span>start<span class="w"> </span>test-vm3<span class="w"> </span>test-vm4
</span></code></pre></div>
<ol>
<li>Verify port settings:</li>
</ol>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>sudo<span class="w"> </span>ovs-vsctl<span class="w"> </span>show<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="s2">&quot;Port&quot;</span>
</span></code></pre></div>
<h3 id="network-interface-configuration">Network Interface Configuration<a class="headerlink" href="#network-interface-configuration" title="Permanent link">&para;</a></h3>
<p>Now we'll configure static IPs for each VM:</p>
<ol>
<li>For VLAN0 (test-vm1 and test-vm2):</li>
</ol>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>multipass<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>test-vmX<span class="w"> </span>--<span class="w"> </span>sudo<span class="w"> </span>ip<span class="w"> </span>link<span class="w"> </span><span class="nb">set</span><span class="w"> </span>ens3<span class="w"> </span>up
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>sudo<span class="w"> </span>ip<span class="w"> </span>addr<span class="w"> </span>add<span class="w"> </span><span class="m">192</span>.168.100.10X<span class="w"> </span>dev<span class="w"> </span>ens3
</span></code></pre></div>
<ol>
<li>For VLAN1 (test-vm3 and test-vm4):</li>
</ol>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>multipass<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>test-vmX<span class="w"> </span>--<span class="w"> </span>sudo<span class="w"> </span>ip<span class="w"> </span>link<span class="w"> </span><span class="nb">set</span><span class="w"> </span>ens3<span class="w"> </span>up
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>sudo<span class="w"> </span>ip<span class="w"> </span>addr<span class="w"> </span>add<span class="w"> </span><span class="m">192</span>.168.200.10X<span class="w"> </span>dev<span class="w"> </span>ens3
</span></code></pre></div>
<h3 id="testing-connectivity">Testing Connectivity<a class="headerlink" href="#testing-connectivity" title="Permanent link">&para;</a></h3>
<p>Let's verify our network configuration:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1"># Test connectivity</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>multipass<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>test-vm1<span class="w"> </span>--<span class="w"> </span>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">192</span>.168.100.102<span class="w"> </span><span class="c1"># Should work</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>multipass<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>test-vm2<span class="w"> </span>--<span class="w"> </span>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">192</span>.168.200.103<span class="w"> </span><span class="c1"># Should not work</span>
</span></code></pre></div>
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h2>
<p>In this tutorial, we have covered:</p>
<ul>
<li>Creating a network bridge</li>
<li>Adding VMs to a network/bridge (always stop instances before attaching)</li>
<li>Creating and configuring VLANs</li>
<li>Setting static IPv4 addresses for VM instances</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>